@startuml

title Predict and Correct Bugs (WP4)
actor "Application Ops Expert" as ops
participant "SODALITE IDE" as sic
participant "Bug Predictor and Fixer" as bp
participant "Predictive Model\nBuilder" as pmb
participant "Semantic Knowledge\nBase" as skb
participant "IaC Quality\nAssessor" as iqa

== Anti Patterns and Smells Based Bug Prediction ==

ops-> sic: Predict Bugs\n(IaC models)
activate sic
sic-> bp: Predict Bugs\n(IaC models)
activate bp
bp -> pmb: Build Ontological\nPredictive Models
activate pmb
pmb -> skb: Retrieve Bug\nPrediction Knowledge
activate skb
skb --> pmb: Bug Prediction Knowledge
deactivate skb
alt Model Building Errors
    pmb --> bp: Model Building Errors
    bp --> sic: Model Building Errors
    sic --> ops: Model Building Errors
else Model Building Success
    pmb --> bp: Ontological Predictive Models
    deactivate pmb
    bp -> bp: Predict Bugs In\nTopology
    bp -> bp: Predict Bugs In\nProvisioning Workflow
    bp -> sic: Bugs\n(with confidence levels)
    sic -> ops: Bugs
    loop Bugs
       ops -> sic: Find Fixes (bug)
       sic -> bp:  Find Fixes (bug)
       bp-> skb: Retrieve Bug Correction Knowledge
       activate skb
       skb -> bp: Bug Correction Knowledge
       deactivate skb
       bp -> sic: Fixes  (with ratings)
       ops -> sic: Fixes (with ratings)
       ops -> ops: Select the Best Fix
       ops -> sic: Fix Bug (bug, fix)
       sic -> bp : Apply Fix (bug, fix)
       bp -> bp :  Apply Fix via\nModel Transformation
       bp --> sic: Corrected IaC
       sic --> ops: Corrected IaC
    end
end
deactivate bp
deactivate sic
newpage
== Metrics based Bug Proneness Prediction ==

ops -> bp: build Bug Proneness Prediction Model\n(IaC dataset, IaC metrics)
activate bp
bp -> pmb: train Model\n(IaC dataset, IaC metrics)
activate pmb
pmb --> bp: bug proneness\nprediction model
deactivate pmb
bp --> ops: bug proneness prediction model
deactivate bp
ops -> sic: predict Bug Proneness\n(IaC models)
activate sic
sic -> bp: predict Bug Proneness\n(IaC models)
activate bp
bp --> iqa: calculate IaC Metrics (IaC models)
activate iqa
iqa --> bp: Iac metrics
deactivate iqa
bp -> bp : predict Bug Proneness index\n(Iac metrics)
bp --> sic: bug proneness index
deactivate bp
sic --> ops: bug proneness index
deactivate sic

@enduml
